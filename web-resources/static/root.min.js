function auth(a){$(".main").fadeOut(250),setTimeout(()=>{$(".auth").hide().fadeIn(250,()=>{$("#tg_icon").html(""),bodymovin.loadAnimation({container:document.getElementById("tg_icon"),renderer:"canvas",loop:!0,autoplay:!0,path:"https://assets9.lottiefiles.com/packages/lf20_bgqoyj8l.json",rendererSettings:{clearCanvas:!0}})}),fetch("/web_auth",{method:"POST",credentials:"include",timeout:25e4}).then(a=>a.text()).then(b=>"TIMEOUT"==b?(error_message("Code waiting timeout exceeded. Reload page and try again."),void $(".auth").fadeOut(250)):b.startsWith("hikka_")?($.cookie("session",b),auth_required=!1,$(".authorized").hide().fadeIn(100),$(".auth").fadeOut(250,()=>{$(".installation").fadeIn(250)}),void a()):void 0)},250)}var qr_interval=null,qr_login=!1,old_qr_sizes=[document.querySelector(".qr_inner").style.width,document.querySelector(".qr_inner").style.height];document.querySelector(".qr_inner").style.width="100px",document.querySelector(".qr_inner").style.height="100px";function login_qr(){$("#denyqr").hide().fadeIn(250),$(".title, .description").fadeOut(250),fetch("/init_qr_login",{method:"POST",credentials:"include"}).then(a=>a.text()).then(a=>{const b=new QRCodeStyling({width:window.innerHeight/3,height:window.innerHeight/3,type:"svg",data:a,dotsOptions:{type:"rounded"},cornersSquareOptions:{type:"extra-rounded"},backgroundOptions:{color:"transparent"},imageOptions:{imageSize:.4,margin:8},qrOptions:{errorCorrectionLevel:"M"}});document.querySelector(".qr_inner").innerHTML="",document.querySelector(".qr_inner").style.width=old_qr_sizes[0],document.querySelector(".qr_inner").style.height=old_qr_sizes[1],b.append(document.querySelector(".qr_inner")),qr_interval=setInterval(()=>{fetch("/get_qr_url",{method:"POST",credentials:"include"}).then(a=>a.text()).then(a=>"SUCCESS"==a||"2FA"==a?($("#block_qr_login").fadeOut(250),$("#denyqr").fadeOut(250),$("#continue_btn, .title, .description").hide().fadeIn(250),"SUCCESS"==a&&switch_block("custom_bot"),"2FA"==a&&(show_2fa(),qr_login=!0),void clearInterval(qr_interval)):void b.update({data:a}))},1250)})}$("#get_started").click(()=>{fetch("/can_add",{method:"POST",credentials:"include"}).then(a=>a.ok?auth_required?auth(()=>{$("#get_started").click()}):void($("#continue_btn").hide().fadeIn(250),$("#denyqr").hide(),$("#enter_api").fadeOut(250),$("#get_started").fadeOut(250,()=>{switch_block(_current_block)})):void show_eula())}),$("#enter_api").click(()=>auth_required?auth(()=>{$("#enter_api").click()}):void($("#get_started").fadeOut(250),$("#enter_api").fadeOut(250,()=>{$("#continue_btn").hide().fadeIn(250),switch_block("api_id")})));function isInt(a){var b=parseFloat(a);return!isNaN(a)&&(0|b)===b}function isValidPhone(a){return /^[+]?\d{11,13}$/.test(a)}function finish_login(){fetch("/finish_login",{method:"POST",credentials:"include"}).then(()=>{$(".installation").fadeOut(2e3),setTimeout(()=>{$("#installation_icon").html(""),bodymovin.loadAnimation({container:document.getElementById("installation_icon"),renderer:"canvas",loop:!0,autoplay:!0,path:"https://assets1.lottiefiles.com/packages/lf20_n3jgitst.json",rendererSettings:{clearCanvas:!0}}),$(".finish_block").fadeIn(250)},2e3)}).catch(a=>{error_state(),error_message("Login confirmation error: "+a.toString())})}function show_2fa(){$(".auth-code-form").hide().fadeIn(250,()=>{$("#monkey-close").html(""),anim=bodymovin.loadAnimation({container:document.getElementById("monkey-close"),renderer:"canvas",loop:!0,autoplay:!0,path:"https://assets1.lottiefiles.com/packages/lf20_eg88dyk9.json",rendererSettings:{clearCanvas:!0}}),anim.addEventListener("complete",()=>{setTimeout(()=>{anim.goToAndPlay(0)},2e3)})}),$(".code-input").removeAttr("disabled"),$(".code-input").attr("inputmode","text"),$(".code-input").attr("autocomplete","off"),$(".code-input").attr("autocorrect","off"),$(".code-input").attr("autocapitalize","off"),$(".code-input").attr("spellcheck","false"),$(".code-input").attr("type","password"),$(".enter").hasClass("tgcode")&&$(".enter").removeClass("tgcode"),$(".code-caption").html("Enter your Telegram 2FA password, then press <span style='color: #dc137b;'>Enter</span>"),cnt_btn.setAttribute("current-step","2fa"),$("#monkey").hide(),$("#monkey-close").hide().fadeIn(100),_current_block="2fa"}function show_eula(){$(".main").fadeOut(250),$(".eula-form").hide().fadeIn(250,()=>{$("#law").html(""),anim=bodymovin.loadAnimation({container:document.getElementById("law"),renderer:"canvas",loop:!0,autoplay:!0,path:"https://static.hikari.gay/forbidden.json",rendererSettings:{clearCanvas:!0}})})}function tg_code(a=!1){return a&&qr_login?void fetch("/qr_2fa",{method:"POST",credentials:"include",body:_2fa_pass}).then(a=>{a.ok?($(".auth-code-form").fadeOut(),$("#block_phone").fadeOut(),switch_block("custom_bot")):($(".code-input").removeAttr("disabled"),a.text().then(a=>{error_state(),Swal.fire("Error",a,"error")}))}):void fetch("/tg_code",{method:"POST",body:`${_tg_pass}\n${_phone}\n${_2fa_pass}`}).then(a=>{a.ok?($(".auth-code-form").fadeOut(),$("#block_phone").fadeOut(),switch_block("custom_bot")):401==a.status?show_2fa():($(".code-input").removeAttr("disabled"),a.text().then(a=>{error_state(),Swal.fire("Error",a,"error")}))}).catch(a=>{Swal.showValidationMessage(`Auth failed: ${a.toString()}`)})}function switch_block(a){cnt_btn.setAttribute("current-step",a);try{$(`#block_${_current_block}`).fadeOut(()=>{$(`#block_${a}`).hide().fadeIn()})}catch{$(`#block_${a}`).hide().fadeIn()}_current_block=a,"qr_login"==_current_block&&login_qr()}function error_message(a){Swal.fire({icon:"error",title:a})}function error_state(){$("body").addClass("red_state"),cnt_btn.disabled=!0,setTimeout(()=>{cnt_btn.disabled=!1,$("body").removeClass("red_state")},1e3)}var _api_id="",_api_hash="",_phone="",_2fa_pass="",_tg_pass="",_current_block=skip_creds?"qr_login":"api_id";function is_phone(){return /Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)}is_phone()&&"qr_login"==_current_block&&(_current_block="phone");const cnt_btn=document.querySelector("#continue_btn");function process_next(){let a=cnt_btn.getAttribute("current-step");if("api_id"==a){let a=document.querySelector("#api_id").value;return 4>a.length||!isInt(a)?void error_state():(_api_id=parseInt(a,10),void switch_block("api_hash"))}if("api_hash"==a){let a=document.querySelector("#api_hash").value;return 32==a.length?(_api_hash=a,void fetch("/set_api",{method:"PUT",body:_api_hash+_api_id,credentials:"include"}).then(a=>a.text()).then(a=>{"ok"==a?switch_block(is_phone()?"phone":"qr_login"):(error_state(),error_message(a))}).catch(a=>{error_state(),error_message("Error occured while saving credentials: "+a.toString())})):void error_state()}if("phone"==a){let a=document.querySelector("#phone").value;if(!isValidPhone(a))return void error_state();_phone=a,fetch("/send_tg_code",{method:"POST",body:_phone,credentials:"include"}).then(a=>{a.ok?($(".auth-code-form").hide().fadeIn(250,()=>{$("#monkey").html(""),anim2=bodymovin.loadAnimation({container:document.getElementById("monkey"),renderer:"canvas",loop:!1,autoplay:!0,path:"https://assets8.lottiefiles.com/private_files/lf30_t52znxni.json",rendererSettings:{clearCanvas:!0}}),anim2.addEventListener("complete",()=>{setTimeout(()=>{anim2.goToAndPlay(0)},2e3)})}),$(".code-input").removeAttr("disabled"),$(".enter").addClass("tgcode"),$(".code-caption").text("Enter the code you recieved in Telegram"),$(".code-input").attr("autocomplete","off"),$(".code-input").attr("autocorrect","off"),$(".code-input").attr("autocapitalize","off"),$(".code-input").attr("spellcheck","false"),$(".code-input").attr("type","number"),cnt_btn.setAttribute("current-step","code"),_current_block="code"):403==a.status?show_eula():a.text().then(a=>{error_state(),error_message(a)})}).catch(a=>{error_state(),error_message("Code send failed: "+a.toString())})}if("2fa"==a){let a=document.querySelector("#_2fa").value;return _2fa_pass=a,void tg_code()}if("custom_bot"==a){let a=document.querySelector("#custom_bot").value;return""!=a&&(!a.toLowerCase().endsWith("bot")||5>a.length)?void Swal.fire({icon:"error",title:"Bot username invalid",text:"It must end with `bot` and be at least 5 symbols in length"}):""==a?void finish_login():void fetch("/custom_bot",{method:"POST",credentials:"include",body:a}).then(a=>a.text()).then(a=>"OCCUPIED"==a?void Swal.fire({icon:"error",title:"This bot username is already occupied!"}):void finish_login()).catch(a=>{error_state(),error_message("Custom bot setting error: "+a.toString())})}}cnt_btn.onclick=()=>cnt_btn.disabled?void 0:auth_required?auth(()=>{cnt_btn.click()}):void process_next(),$("#denyqr").on("click",()=>{qr_interval&&clearInterval(qr_interval),$("#denyqr").fadeOut(250),$("#continue_btn, .title, .description").hide().fadeIn(250),switch_block("phone")}),$(".installation input").on("keyup",a=>cnt_btn.disabled?void 0:auth_required?auth(()=>{cnt_btn.click()}):void(("Enter"===a.key||13===a.keyCode)&&process_next())),$(".code-input").on("keyup",a=>{if("code"==_current_block&&5==$(".code-input").val().length)_tg_pass=$(".code-input").val(),$(".code-input").attr("disabled","true"),$(".code-input").val(""),tg_code();else if("2fa"==_current_block&&("Enter"===a.key||13===a.keyCode)){let a=$(".code-input").val();_2fa_pass=a,$(".code-input").attr("disabled","true"),$(".code-input").val(""),tg_code(!0)}}),$(".enter").on("click",()=>{if("2fa"==_current_block){let a=$(".code-input").val();_2fa_pass=a,$(".code-input").attr("disabled","true"),$(".code-input").val(""),tg_code(!0)}}),$(document).ready(()=>{new Sakura("body")});